
## Структура таблиц GP

#### Цель:
Эта лабораторная работа направлена на изучение различий в хранении данных, извлечении и сжатии между таблицами кучи и колоночными таблицами в Greenplum. К концу этой лаборатории вы узнаете, как различные типы таблиц и настройки влияют на производительность и эффективность хранения данных в базе данных.

#### Предварительные требования:
- Доступ к базе данных Greenplum
- Базовые знания SQL

#### Шаги:
1. **Настройка среды базы данных**
    - Начните с удаления существующей базы данных с именем `database_name`, а затем создайте её заново:
      ```sql
      DROP DATABASE IF EXISTS database_name;
      CREATE DATABASE database_name;
      ```
    - Подключитесь к вновь созданной базе данных и убедитесь, что схема public доступна:
      ```sql
      CREATE SCHEMA IF NOT EXISTS public;
      ```

2. **Создание и заполнение таблицы кучи**
    - Удалите существующую таблицу кучи и создайте новую:
      ```sql
      DROP TABLE IF EXISTS heap_t;
      CREATE TABLE heap_t (a int, b text);
      ```
    - Вставьте 10 миллионов строк в `heap_t` с случайными данными:
      ```sql
      INSERT INTO heap_t (a, b)
      SELECT id, (random() + random()) * 1000000
      FROM pg_catalog.generate_series(1, 10000000) id;
      ```
    - Проверьте количество вставленных строк и размер таблицы:
      ```sql
      SELECT count(*) FROM heap_t;
      SELECT pg_size_pretty(pg_total_relation_size('heap_t'));
      ```

3. **Создание и заполнение колоночной таблицы**
    - Удалите существующую колоночную таблицу и создайте новую с сжатием:
      ```sql
      DROP TABLE IF EXISTS column_t;
      CREATE TABLE column_t (a int, b text)
      WITH (appendoptimized=true, orientation=column, compresstype = zstd, compresslevel = 3);
      ```
    - Вставьте 10 миллионов строк в `column_t` с той же логикой генерации случайных данных:
      ```sql
      INSERT INTO column_t (a, b)
      SELECT id, (random() + random()) * 1000000
      FROM pg_catalog.generate_series(1, 10000000) id;
      ```
    - Проверьте количество строк и размер сжатой колоночной таблицы:
      ```sql
      SELECT count(*) FROM column_t;
      SELECT pg_size_pretty(pg_total_relation_size('column_t'));
      ```

#### Самопроверка:
- **Сравнение размера**: После выполнения запросов на размер обеих таблиц сравните результаты. Обратите внимание на то, как размер хранения отличается между таблицей кучи и колоночной таблицей.
- **Проверка производительности**: Оцените время, затраченное на выполнение операторов `INSERT` для обоих типов таблиц. Это поможет вам понять последствия производительности использования хранилища кучи по сравнению с колоночным.
- **Понимание сжатия**: Проанализируйте, как настройки сжатия в колоночной таблице влияют на размер хранения по сравнению с несжатой таблицей кучи.
